<h3 class='sidebar-title'>
  <label for="live_search"><%= sidebar.title %></label>
</h3>
<%= form_tag({:controller => 'articles',  :action => 'search'}, {:method => 'get', :id => 'sform'}) do %>
  <%= text_field_tag :q, '', {:id => "live_search", :size => 15, :autocomplete => "off"} %>
  <%= image_tag "spinner-blue.gif", :id => 'livesearch_spinner', :style => 'display:none;' %>
<% end %>
<div id="livesearch-results" class="results"></div>
<script>
(function() {
  var searchInput = document.getElementById('live_search');
  var spinner = document.getElementById('livesearch_spinner');
  var results = document.getElementById('livesearch-results');
  var timeout = null;

  if (searchInput) {
    searchInput.addEventListener('input', function() {
      clearTimeout(timeout);
      timeout = setTimeout(function() {
        var query = searchInput.value;
        if (query.length > 0) {
          spinner.style.display = 'inline';
          fetch('<%= live_search_articles_url %>?q=' + encodeURIComponent(query))
            .then(function(response) { return response.text(); })
            .then(function(html) {
              results.innerHTML = html;
              spinner.style.display = 'none';
            })
            .catch(function() { spinner.style.display = 'none'; });
        } else {
          results.innerHTML = '';
        }
      }, 500);
    });
  }
})();
</script>
