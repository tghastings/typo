<h3><%= sidebar.title %></h3>
<% if sidebar.show_example_content || sidebar.flickr_user_id.present? %>
  <div class="flickr-container">
    <div class="flickr-photos">
<% sidebar.photos.each_with_index do |photo, index| %>
      <a href="#" data-flickr-lightbox data-full-src="<%= photo.url_s || sidebar.photo_url(photo) %>" data-title="<%= photo.title %>" title="<%= photo.title %>">
        <img src="<%= sidebar.photo_url(photo) %>" alt="<%= photo.title %>" loading="lazy">
      </a>
<% end %>
    </div>
    <div class="flickr-lightbox" id="flickr-lightbox">
      <div class="flickr-lightbox-img-container">
        <span class="flickr-lightbox-close">&times;</span>
        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" id="flickr-lightbox-img">
      </div>
      <div class="flickr-lightbox-title" id="flickr-lightbox-title"></div>
    </div>
  </div>
  <script>
    (function() {
      var lightbox = document.getElementById('flickr-lightbox');
      var lightboxImg = document.getElementById('flickr-lightbox-img');
      var lightboxTitle = document.getElementById('flickr-lightbox-title');
      var closeBtn = lightbox.querySelector('.flickr-lightbox-close');
      document.querySelectorAll('[data-flickr-lightbox]').forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          lightboxImg.src = this.dataset.fullSrc;
          lightboxImg.alt = this.dataset.title;
          lightboxTitle.textContent = this.dataset.title;
          lightbox.classList.add('active');
        });
      });
      function closeLightbox() {
        lightbox.classList.remove('active');
      }
      closeBtn.addEventListener('click', closeLightbox);
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeLightbox();
      });
    })();
  </script>
<% else %>
  <p><em>Please configure your Flickr User ID</em></p>
<% end %>
