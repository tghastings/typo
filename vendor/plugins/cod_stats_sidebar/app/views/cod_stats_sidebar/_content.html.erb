<h3><%= sidebar.title %></h3>
<% if !sidebar.configured? && !sidebar.show_example_content %>
  <p><em>Please configure your COD Tracker credentials</em></p>
<% else %>
  <% data = sidebar.stats %>
  <% if data.nil? %>
    <p><em>Unable to fetch stats</em></p>
  <% else %>
    <div class="cod-stats">
      <% if data['platformInfo'] %>
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
          <% if data['platformInfo']['avatarUrl'] %>
            <img src="<%= data['platformInfo']['avatarUrl'] %>" alt="" style="width: 40px; height: 40px; border-radius: 50%;" />
          <% end %>
          <div style="font-weight: 600;"><%= data['platformInfo']['platformUserHandle'] %></div>
        </div>
      <% end %>

      <% if data['segments'] %>
        <% overview = data['segments'].find { |s| s['type'] == 'overview' } %>
        <% if overview && overview['stats'] %>
          <table style="width: 100%; font-size: 0.85rem; border-collapse: collapse;">
            <% if overview['stats']['kills'] %>
              <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 4px 0;">Kills</td>
                <td style="padding: 4px 0; text-align: right; font-weight: 500;"><%= sidebar.format_stat(overview['stats']['kills']['value']) %></td>
              </tr>
            <% end %>
            <% if overview['stats']['deaths'] %>
              <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 4px 0;">Deaths</td>
                <td style="padding: 4px 0; text-align: right; font-weight: 500;"><%= sidebar.format_stat(overview['stats']['deaths']['value']) %></td>
              </tr>
            <% end %>
            <% if overview['stats']['kdRatio'] %>
              <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 4px 0;">K/D Ratio</td>
                <td style="padding: 4px 0; text-align: right; font-weight: 600; color: #930;"><%= overview['stats']['kdRatio']['displayValue'] %></td>
              </tr>
            <% end %>
            <% if overview['stats']['wins'] %>
              <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 4px 0;">Wins</td>
                <td style="padding: 4px 0; text-align: right; font-weight: 500;"><%= sidebar.format_stat(overview['stats']['wins']['value']) %></td>
              </tr>
            <% end %>
            <% if overview['stats']['timePlayed'] %>
              <tr>
                <td style="padding: 4px 0;">Time Played</td>
                <td style="padding: 4px 0; text-align: right; font-weight: 500;"><%= overview['stats']['timePlayed']['displayValue'] %></td>
              </tr>
            <% end %>
          </table>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% end %>
