<h3><%= sidebar.title %></h3>
<% if !sidebar.configured? && !sidebar.show_example_content %>
  <p><em>Please configure Spotify credentials</em></p>
<% else %>
  <% now = sidebar.now_playing %>
  <% if now && now['is_playing'] %>
    <div class="spotify-now-playing" style="margin-bottom: 12px;">
      <div style="font-size: 0.75rem; color: #1DB954; margin-bottom: 4px;">Now Playing</div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <% if now['item'] && now['item']['album'] && now['item']['album']['images'].any? %>
          <img src="<%= now['item']['album']['images'].last['url'] %>" alt="" style="width: 48px; height: 48px; border-radius: 4px;" />
        <% end %>
        <div>
          <div style="font-weight: 500;"><%= now['item']['name'] %></div>
          <div style="font-size: 0.85rem; color: #666;"><%= now['item']['artists'].map { |a| a['name'] }.join(', ') %></div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="spotify-recent">
    <div style="font-size: 0.75rem; color: #666; margin-bottom: 8px;">Recently Played</div>
    <ul style="list-style: none; margin: 0; padding: 0;">
      <% sidebar.recently_played.each do |item| %>
        <li style="margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee;">
          <a href="<%= item['track']['external_urls']['spotify'] %>" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
            <div style="font-weight: 500;"><%= item['track']['name'] %></div>
            <div style="font-size: 0.85rem; color: #666;"><%= item['track']['artists'].map { |a| a['name'] }.join(', ') %></div>
          </a>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>
